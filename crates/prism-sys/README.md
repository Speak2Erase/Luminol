> [!IMPORTANT]
> luminol-prism-sys is currently based on ruby/prism@0.18.0

> [!IMPORTANT]
> luminol-prism-sys uses a vendored version of prism.
> We are temporarily vendoring our own version as one of the prism build steps requires rake (which needs ruby.)
> This step is only necessary to generate code, however, and the resulting code is independent of ruby.
>
> When updating from upstream prism you MUST update the prism source in `vendor/prism-{prism version}`.
> You can do this by cloning prism and running `rake templates`, and then copying over the source files into the vendor folder.
>
> Eventually when ruby releases prism on crates.io this will not be an issue and we can remove prism from our source tree.

> [!NOTE]
> This is Luminol's modified version of prism-sys. The original version is licensed under MIT. 
>
> To merge changes from upstream into this crate, first add prism as a remote:
>
> ```
> git remote add -f --no-tags prism https://github.com/ruby/prism
> ```
>
> Now, decide on which upstream prism commit you want to merge from and figure out the prism commit that the previous upstream merge was based on. The basis of the previous upstream merge should be written at the top of this README. **Please update the top of this README after merging.**
>
> In this example, we are merging from commit `6ca8896` (prism 0.18.0) and the previous merge was based on commit `d76f295` (prism 0.17.0).
>
> ```
> git diff \
>     d76f295:rust/prism-sys \
>     6ca8896:rust/prism-sys |
>     git apply -3 --directory=crates/prism-sys
> ```
>
> Fix any merge conflicts, and then do `git commit`.

# prism-sys

Rust bindings to [ruby/prism](https://github.com/ruby/prism)'s C API.

## Examples

Currently the best examples are found in the integration tests (in `tests/`).

## Documentation

Since this crate has not been released, docs are not yet online anywhere. You can generate them,
however, from this directory in this repo by running `cargo doc`, then opening
`target/doc/prism_sys/index.html` in your browser. (You could, instead, combine those two steps by
doing `cargo doc --open`!)

## Development

### Dependencies

In addition to the Ruby prism dependencies, you shouldn't need anything else besides Rust.

### Updating bindings

`build.rs` (which gets called as part of running `cargo build`, `cargo test`, etc) is where we tell
`bindgen` which types, functions, etc. that we want it to generate for us. It's smart enough to know
to generate dependencies for items we specify in there (ex. `pm_parser_t` has fields of type
`pm_token_t`, but we don't need to tell `bindgen` about `pm_token_t`--it'll figure it out and
generate bindings for that type too).

If you want to generate new bindings, update `build.rs` accordingly, then run `cargo doc` and check
the docs; that should tell you if `bindgen` generated all the things you need or not.

### Testing

Since almost all of the code is generated by the well-tested
[`bindgen`](https://github.com/rust-lang/rust-bindgen) crate, we only have some cursory integration
tests in `tests/`, really just validating types and functions got generated appropriately. (They
also give some hints about how to use the API from Rust!) To run the tests, run `cargo test`.

Any new publicly exposed C API additions should get a test or two.
